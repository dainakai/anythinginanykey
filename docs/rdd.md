# 「Anything in AnyKey」要件定義書
作成日: 2025年4月6日

## 1. はじめに

### 1.1 目的
本文書は、ジャズなどのインプロヴィゼーションを行うミュージシャン向けのフレーズ管理・共有サービス「Anything in AnyKey」の要件を定義するものである。本サービスは、ミュージシャンがさまざまなメロディフレーズや音楽的アプローチを効率的に練習し習得するための環境を提供することを目的としている。

### 1.2 対象読者
- 開発チーム
- プロジェクト関係者
- サービス企画担当者

### 1.3 用語定義
- **フレーズ**: ABC notation形式で記述された、拍子、メロディ、コード進行を含む音楽情報の単位
- **キー**: 12音いずれかの主音と、メジャーかマイナーかを指定したもの
- **コード進行**: 小節の上に記載されるコードの連続
- **タグ**: フレーズを分類・検索するためのキーワード
- **異名同音**: 同じ音高を持つが表記が異なる音（例：C#とD♭）
- **ABC notation**: テキストベースの音楽記譜法で、メロディ、コード進行、拍子などを単一のテキスト内に記述する形式

## 2. システム概要

### 2.1 サービスコンセプト
「Anything in AnyKey」は、ミュージシャンがメロディフレーズやコード進行を登録・共有・検索し、あらゆるキーで練習できるプラットフォームである。ユーザーは自分のフレーズライブラリを構築し、他のユーザーと共有することで、音楽的語彙を効率的に拡大することができる。サービス名の「Anything in AnyKey」は、あらゆるフレーズをあらゆるキーで練習できることを意味している。

### 2.2 主要機能
- フレーズの登録・編集・削除（ABC notation形式）
- フレーズの閲覧・検索
- フレーズの共有とフォーク
- フレーズの評価（スター機能）
- 全キーへの自動移調表示
- タグによるフレーズ管理

### 2.3 ユーザー層
- ジャズミュージシャン
- インプロヴィゼーションを行う音楽家
- 音楽教育者・学習者
- 作曲家・編曲家

## 3. 機能要件

### 3.1 ユーザー管理
- Google アカウント等を利用したソーシャルログイン機能
- ユーザープロフィール管理
- ユーザー別フレーズライブラリ

### 3.2 フレーズ管理
#### 3.2.1 フレーズの基本情報
- ABC notation形式のフレーズデータ（拍子、メロディ、コード進行を含む）
- 元のキー情報（移調処理のために別途保持）
- 登録日・更新日
- スター数
- コメント（使用想定シーンなど）
- タグ

#### 3.2.2 フレーズの登録・編集
- ABC notation形式でのフレーズ入力
  - 拍子・ベースとなる音符長の指定（M:, L:ヘッダー）
  - キーの指定（K:ヘッダー）
  - コード進行の指定
  - メロディの入力
- フレーズの編集・更新
- フレーズの削除
- 将来的な拡張としてGUIベースの入力を検討

#### 3.2.3 フレーズの表示
- 楽譜表示（調号なし、すべて臨時記号で表示）
- 全キー（12キー）への自動移調表示
  - 元のキー情報を基に、abcjsのvisualTransposeまたはstrTranspose機能を使用
  - 移調されたABC notationデータの生成と表示
- 異名同音の適切な表記（キーに応じた正しい表記の選択）
- 異名同音の表記をユーザーが修正できる機能

### 3.3 フレーズ共有機能
- 個人ライブラリとグローバル共有の切り替え
- 他ユーザーのフレーズの自分のライブラリへの追加
- フレーズのフォーク（コピー後の修正と新規登録）
- スター機能（評価システム）

### 3.4 検索・フィルタリング機能
- タグによるフィルタリング
  - グローバルフレーズ：プリセットタグから選択
    - 例："Major 2-5-1", "Minor 2-5-1", "1625", "Dominant 7th", "Diminished"など
  - 個人フレーズ：自由にタグ付け可能
- テキスト検索（コメント等）
- 人気順（スター数）、新着順などのソート

## 4. 非機能要件

### 4.1 ユーザビリティ
- 直感的なUI/UX設計
- レスポンシブデザイン（PC、タブレット、スマートフォン対応）
  - モバイル対応は高優先度
- 楽譜表示の視認性確保
- 初心者向けチュートリアル・ヘルプ機能（ABC notation入力の説明を含む）

### 4.2 パフォーマンス
- ページロード時間：3秒以内
- 楽譜レンダリング：1秒以内
- 全キー移調表示：3秒以内
- 同時接続ユーザー数：初期段階では100人程度、将来的には拡張可能な設計

### 4.3 セキュリティ
- OAuth2.0などによる外部認証サービス連携
- HTTPS通信の強制
- XSS、CSRF対策
- データバックアップ体制

### 4.4 拡張性・保守性
- モジュール化された設計
- APIの整備（将来的な機能拡張に備える）
- バージョン管理システムの導入

## 5. 技術要件

### 5.1 フロントエンド
- HTML5, CSS3, JavaScript
- フレームワーク候補：React, Vue.js, Angular等
- 楽譜レンダリングライブラリ：abcjs
  - 移調機能（visualTranspose, strTranspose）の活用
  - 楽譜表示のカスタマイズ
- レスポンシブデザインフレームワーク（モバイル対応優先）

### 5.2 バックエンド
- サーバーサイド言語：Node.js, Python, Ruby等
- データベース：MongoDB, PostgreSQL等
- 認証：OAuth2.0（Google, Facebook等）
- APIフレームワーク

### 5.3 インフラストラクチャ
- クラウドホスティング（AWS, GCP, Azure等）
- CDN活用
- スケーラブルなアーキテクチャ（初期は小規模から始め、需要に応じて拡張可能な設計）

## 6. UI/UX要件

### 6.1 画面構成
- ログイン/登録画面
- ダッシュボード（自分のフレーズライブラリ）
- グローバルフレーズ一覧
- フレーズ詳細画面（全キー表示）
- フレーズ登録/編集画面（ABC notationエディタ）
- 検索/フィルタリング画面
- ユーザープロフィール画面
- ヘルプ/チュートリアル画面（ABC notation入力の説明を含む）

### 6.2 ユーザーフロー
1. ログイン
2. ダッシュボード表示
3. フレーズ閲覧/検索
4. フレーズ詳細確認
5. フレーズ登録/編集
6. フレーズ共有/評価

## 7. データモデル（概要）

### 7.1 ユーザー
- ID
- 認証情報（外部認証連携）
- プロフィール情報
- 作成日時/更新日時

### 7.2 フレーズ
- ID
- 作成者ID
- ABC notation形式のフレーズデータ
- 元のキー情報（移調処理用）
- コメント
- タグ（複数）
- 公開フラグ
- スター数
- フォーク元ID（該当する場合）
- 作成日時/更新日時

### 7.3 タグ
- ID
- 名前
- タイプ（プリセット/ユーザー定義）
- 作成者ID（ユーザー定義の場合）
- 作成日時/更新日時

## 8. 多言語対応

- 日本語（優先）
- 英語

## 9. 収益モデル

- 初期段階：無料プロトタイプとして公開
- 将来的なサブスクリプションモデル
  - 登録可能なフレーズ数の制限
  - フレーズの移調機能の有料化

## 10. 開発スケジュール（案）
- 要件定義：2週間
- 設計：3週間
- 開発：12週間
- テスト：4週間
- リリース準備：2週間
- 合計：約23週間（約6ヶ月）

## 11. 追加提案

### 11.1 ABC notation入力支援機能
- ABC notationのリアルタイムプレビュー
- 構文エラーのハイライト表示
- ABC notationテンプレートの提供
- ABC notation入力のオートコンプリート機能

### 11.2 フレーズコレクション機能
- 関連するフレーズをコレクションとしてグループ化
- 練習セッションの作成（複数フレーズの連続練習）
- 難易度別コレクションの提供

### 11.3 プログレッショントラッキング
- ユーザーが練習したフレーズの記録
- 習熟度の自己評価機能
- 練習推奨フレーズの提案

### 11.4 エクスポート機能
- フレーズやコレクションのPDF出力
- MusicXML形式でのエクスポート（将来的な拡張）

### 11.5 モバイル最適化
- オフラインキャッシュ（頻繁に使用するフレーズ）
- タッチスクリーン向け最適化
- 画面回転対応（縦横両方での最適表示）

## 12. 実装上の注意点

### 12.1 異名同音の処理
- キーに応じた適切な異名同音の選択（例：Aメジャーでは、C#の音はC#で表記されD♭ではない）
- ユーザーによる異名同音表記の修正機能の実装
- 移調時の異名同音処理の正確性確保

### 12.2 ABC notation入力システム
- ABC notationの詳細なチュートリアルとヘルプドキュメントの提供
- エラー処理と入力支援機能の充実
- abcjsライブラリの移調機能（visualTranspose, strTranspose）の適切な活用

### 12.3 モバイル対応
- タッチ操作に最適化されたインターフェース
- 画面サイズに応じた楽譜表示の最適化
- モバイルでのABC notation入力の使いやすさ確保

### 12.4 スケーラビリティ
- ユーザー数増加に対応できるシステム設計
- データベースのパフォーマンス最適化

## 13. ABC notationとabcjsに関する技術的考慮事項

### 13.1 ABC notationの基本構造
- ABC notationはヘッダー部分（メタデータ）と本体部分（メロディ）で構成される
- ヘッダー部分には以下の情報が含まれる：
  - X: インデックス番号
  - T: タイトル
  - M: 拍子
  - L: デフォルトの音符長
  - K: キー
- 本体部分にはメロディとコード進行が記述される
- メロディとフレーズは同一テキスト内に一体として記述される

### 13.2 abcjsの移調機能
- abcjsには以下の移調機能がある：
  - visualTranspose: 表示のみを移調（元のABC文字列は変更されない）
  - midiTranspose: 音声のみを移調
  - strTranspose: ABC文字列自体を移調して新しい文字列を生成
- 12キーへの移調表示には、元のキー情報を基準として半音単位で移調する必要がある
- 移調処理では異名同音の適切な処理が重要

### 13.3 データ構造の最適化
- フレーズデータはABC notation形式で一体的に保存
- キー情報は移調処理のために別途保持
- 移調表示時には元のキーと表示キーの差分を計算し、適切な移調処理を適用
- 異名同音の表記はキーコンテキストに応じて最適化

### 13.4 実装アプローチ
- フレーズの保存：完全なABC notation形式で保存
- キー情報：移調処理のために別フィールドとして保持
- 表示処理：
  1. 元のキーと表示キーの差分を計算
  2. abcjsのvisualTransposeまたはstrTranspose機能を使用して移調
  3. 異名同音の表記を最適化
  4. 楽譜レンダリング
