# ABC Notation 入力ガイド

「Anything in AnyKey」では、音楽フレーズを [ABC Notation](http://abcnotation.com/) というテキストベースの形式で入力します。このガイドでは、基本的な入力方法について説明します。

## 1. 基本構造

ABC Notationは、**ヘッダー**と**本体**の2つの部分で構成されます。

-   **ヘッダー**: フレーズのタイトル、拍子、キーなどのメタ情報を記述します。
-   **本体**: メロディやコード進行を記述します。

```abc
X: 1                 % ヘッダー: インデックス番号 (必須)
T: Simple Tune       % ヘッダー: タイトル (必須)
M: 4/4               % ヘッダー: 拍子 (必須)
L: 1/4               % ヘッダー: デフォルトの音符長 (必須)
K: C                 % ヘッダー: キー (必須、元のキーとして重要)
"Cmaj7" C E G B | "Fmaj7" F A c e | "G7" G B d f | "Cmaj7" c4 | % 本体: メロディとコード
```

## 2. ヘッダーの入力

各ヘッダー情報は、`記号:` の形式で1行に1つ記述します。

-   `X:` **インデックス番号**: フレーズの一意な番号です。通常、システムが自動で割り当てます。
-   `T:` **タイトル**: フレーズのタイトルです。
-   `M:` **拍子**: 拍子記号を指定します。例: `M:4/4`, `M:3/4`, `M:C` (4/4), `M:C|` (2/2)。
-   `L:` **デフォルトの音符長**: 最も頻繁に使用する音符の長さを分数で指定します。例: `L:1/4` (四分音符), `L:1/8` (八分音符)。
-   `K:` **キー**: フレーズの元のキーを指定します。メジャーキーは大文字、マイナーキーは小文字の`m`を付けます。例: `K:C` (ハ長調), `K:Gm` (ト短調), `K:Eb` (変ホ長調)。キーはこのサービスの移調機能の基準となるため、正確に指定してください。

**必須ヘッダー**: `X:`, `T:`, `M:`, `L:`, `K:` は必ず記述してください。

## 3. 本体の入力

### 3.1 メロディの入力

-   **音名**: `C`, `D`, `E`, `F`, `G`, `A`, `B` で音名を指定します。小文字 (`c`, `d`, ... `b`) は1オクターブ上の音を示します。
-   **オクターブ**:
    -   `,` (カンマ): 1オクターブ下げる (例: `C,`)
    -   `'` (アポストロフィ): 1オクターブ上げる (例: `c'`)
    -   複数重ねることも可能 (例: `C,,`, `c''`)
-   **臨時記号**: 音名の前に付けます。
    -   `^`: シャープ (例: `^C`, `^f`)
    -   `_`: フラット (例: `_B`, `_e`)
    -   `=`: ナチュラル (例: `=C`, `=g`)
    -   複数重ねてダブルシャープ (`^^`) やダブルフラット (`__`) も可能です。
-   **音価**: 音名の後に数字や記号を付けて、デフォルトの音符長 (`L:`) に対する相対的な長さを指定します。
    -   数字: デフォルト音符長の倍数を指定 (例: `C2` は L:1/4 なら二分音符、`C4` は全音符)
    -   `/`: デフォルト音符長の分数を指定 (例: `C/` または `C/2` は L:1/4 なら八分音符、`C/4` は十六分音符)
    -   `3/2`: 付点音符 (例: `C3/2` は L:1/4 なら付点四分音符)
    -   `>`: 次の音符の長さを半分にし、前の音符の長さを1.5倍にする (例: `C>D` は付点八分音符＋十六分音符)
    -   `<`: 前の音符の長さを半分にし、次の音符の長さを1.5倍にする (例: `C<D` は十六分音符＋付点八分音符)
    -   音価を指定しない場合は、デフォルトの音符長 (`L:`) が適用されます。
-   **休符**: `z` で表します。音価の指定方法は音符と同じです (例: `z`, `z2`, `z/`)。
-   **小節線**: `|` で表します。複縦線は `||`、終止線は `|]`、リピート開始は `|:`、リピート終了は `:|` です。
-   **連符**: `(3` で三連符の開始を示します (例: `(3 C D E`)。`(p` で p連符を開始します (例: `(5 a b c d e`)。

### 3.2 コード進行の入力

コードシンボルをダブルクォーテーション (`"`) で囲み、対応するメロディの音符の **前に** 記述します。

```abc
"Cmaj7" C E G B | "Fmaj7" F A c e | "G7" G B d f | "Cmaj7" c4 |
```

一つの小節内に複数のコードがある場合も同様です。

```abc
"Am7" A c "D7" d f | "Gm7" G B "C7" c e | "Fmaj7" F A c e |
```

## 4. 入力例

```abc
X:1
T:Autumn Leaves (First 8 bars)
M:4/4
L:1/8
K:Gm
"Cm7" GAB=c "F7"_d2cB | "Bbmaj7" BAGF "Ebmaj7"_E2D2 |
"Am7b5" c=Bc^d "D7"=e2dc | "Gm" B2A2 G4 |
"Cm7" GAB=c "F7"_d2cB | "Bbmaj7" BAGF "Ebmaj7"_E2D2 |
"Am7b5" c=Bc^d "D7"=e2^f2 | "Gm" gfed cBAG ||
```

このABC Notationは以下のように表示されます (プレビュー機能で確認できます)。
*(ここに実際のプレビュー表示のイメージ図や説明を入れるとより親切ですが、テキストベースで続けます)*

## 5. 入力支援機能

フレーズ入力画面では、入力したABC Notationがリアルタイムで楽譜としてプレビュー表示されます。構文エラーがある場合も指摘されるため、確認しながら入力してください。

## 6. 注意点

-   **異名同音**: シャープ (`^`) とフラット (`_`) のどちらを使うかは、元のキー (`K:`) や音楽的な文脈によって判断されますが、サービス内での移調表示時に自動的に調整される場合があります。意図した表記にならない場合は、現時点では直接ABC Notationを修正してください。（将来的に編集機能が追加される可能性があります）
-   **大文字/小文字**: 音名の大文字/小文字はオクターブを示します。ヘッダー記号 (`X:`, `T:` など) は大文字で記述してください。

より詳細な記法については、[ABC Notationの公式ドキュメント](http://abcnotation.com/wiki/abc:standard:v2.1) などを参照してください。
